!function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var a=t(function(t){var e=function(s){var c,t=Object.prototype,l=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n,r){var i=e&&e.prototype instanceof o?e:o,s=Object.create(i.prototype),a=new V(r||[]);return s._invoke=function(s,a,o){var c=h;return function(t,e){if(c===m)throw new Error("Generator is already running");if(c===p){if("throw"===t)throw e;return T()}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){var r=S(n,o);if(r){if(r===d)continue;return r}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(c===h)throw c=p,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);c=m;var i=u(s,a,o);if("normal"===i.type){if(c=o.done?p:f,i.arg===d)continue;return{value:i.arg,done:o.done}}"throw"===i.type&&(c=p,o.method="throw",o.arg=i.arg)}}}(t,n,a),s}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var h="suspendedStart",f="suspendedYield",m="executing",p="completed",d={};function o(){}function g(){}function v(){}var _={};_[i]=function(){return this};var w=Object.getPrototypeOf,y=w&&w(w(E([])));y&&y!==t&&l.call(y,i)&&(_=y);var k=v.prototype=o.prototype=Object.create(_);function b(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function x(c){var e;this._invoke=function(n,r){function t(){return new Promise(function(t,e){!function e(t,n,r,i){var s=u(c[t],c,n);if("throw"!==s.type){var a=s.arg,o=a.value;return o&&"object"==typeof o&&l.call(o,"__await")?Promise.resolve(o.__await).then(function(t){e("next",t,r,i)},function(t){e("throw",t,r,i)}):Promise.resolve(o).then(function(t){a.value=t,r(a)},function(t){return e("throw",t,r,i)})}i(s.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}}function S(t,e){var n=t.iterator[e.method];if(n===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,S(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(l.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=c,t.done=!0,t};return r.next=r}}return{next:T}}function T(){return{value:c,done:!0}}return g.prototype=k.constructor=v,v.constructor=g,v[r]=g.displayName="GeneratorFunction",s.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,r in t||(t[r]="GeneratorFunction")),t.prototype=Object.create(k),t},s.awrap=function(t){return{__await:t}},b(x.prototype),x.prototype[n]=function(){return this},s.AsyncIterator=x,s.async=function(t,e,n,r){var i=new x(a(t,e,n,r));return s.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},b(k),k[r]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},s.keys=function(n){var r=[];for(var t in n)r.push(t);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},s.values=E,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return s.type="throw",s.arg=n,r.next=t,e&&(r.method="next",r.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e],s=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=l.call(i,"catchLoc"),o=l.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&l.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=c),d}},s}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}});function c(t,e,n,r,i,s,a){try{var o=t[s](a),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(r,i)}var o=function(o){return function(){var t=this,a=arguments;return new Promise(function(e,n){var r=o.apply(t,a);function i(t){c(r,e,n,i,s,"next",t)}function s(t){c(r,e,n,i,s,"throw",t)}i(void 0)})}};var l=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(){!function(t){(0<arguments.length&&void 0!==t?t:i).innerHTML=""}();for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];!function(t,e){var n=0<arguments.length&&void 0!==t?t:i;(1<arguments.length?e:void 0).forEach(function(t){return n.appendChild(t)})}(i,e)}var u=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t},i=document.querySelector("main.central"),n=t(function(e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(t){return n(t)}:e.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},r(t)}e.exports=r});var s=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var h=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?s(t):e},f=t(function(e){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(t)}e.exports=n}),m=t(function(n){function r(t,e){return n.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}n.exports=r});var p=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)},d=function(){function t(){if(l(this,t),(this instanceof t?this.constructor:void 0)===t)throw new Error("Can't instantiate AbstractView, only concrete one")}return u(t,[{key:"_render",value:function(){return t.createDomElement(this.template)}},{key:"bind",value:function(){}},{key:"template",get:function(){throw new Error("Template is required")}},{key:"element",get:function(){return this._element||(this._element=this._render(),this.bind(this._element)),this._element}}],[{key:"createDomElement",value:function(t){return function(t,e){var n=document.createElement(t);return n.innerHTML=e.trim(),n}("div",t).firstChild}}]),t}(),g=function(){function t(){return l(this,t),h(this,f(t).apply(this,arguments))}return p(t,d),u(t,[{key:"template",get:function(){return'\n      <footer class="footer">\n        <a href="https://htmlacademy.ru" class="social-link">\n          <span class="visually-hidden">HTML Academy</span>\n          <svg class="icon" width="108" height="37" viewBox="0 0 108 37" fill="#000000">\n            <use xlink:href="img/sprite.svg#logo-htmla"></use>\n          </svg>\n        </a>\n        <span class="footer__made-in">Сделано в <a href="https://htmlacademy.ru" class="footer__link">HTML Academy</a> &copy; 2019</span>\n        <div class="footer__social-links">\n          <a href="https://twitter.com/htmlacademy_ru" class="social-link">\n            <span class="visually-hidden">Твиттер</span>\n            <svg class="icon" width="29" height="29" viewBox="0 0 29 29" fill="#000000">\n              <use xlink:href="img/sprite.svg#icon-tw"></use>\n            </svg>\n          </a>\n          <a href="https://www.instagram.com/htmlacademy/" class="social-link">\n            <span class="visually-hidden">Инстаграм</span>\n            <svg class="icon" width="29" height="29" viewBox="0 0 29 29" fill="#000000">\n              <use xlink:href="img/sprite.svg#icon-ig"></use>\n            </svg>\n          </a>\n          <a href="https://www.facebook.com/htmlacademy" class="social-link">\n            <span class="visually-hidden">Фейсбук</span>\n            <svg class="icon" width="29" height="29" viewBox="0 0 29 29" fill="#000000">\n              <use xlink:href="img/sprite.svg#icon-fb"></use>\n            </svg>\n          </a>\n          <a href="https://vk.com/htmlacademy" class="social-link">\n            <span class="visually-hidden">ВКонтакте</span>\n            <svg class="icon" width="29" height="29" viewBox="0 0 29 29" fill="#000000">\n              <use xlink:href="img/sprite.svg#icon-vk"></use>\n            </svg>\n          </a>\n        </div>\n      </footer>'}}]),t}();function v(t,e){var n=1<arguments.length&&void 0!==e&&e;return n?t.filter(function(t){return t===n}).length:t.length}function _(t){var e=t.answers,n=t.lives,r=Object.assign({},N.gameResult);return!Number.isInteger(n)||!Array.isArray(e)||e.length!==T.levels||n<0||3<n?r.score=-1:(r.success=v(e,L)<T.lives,r.totalAnswersCount=v(e),r.correctAnswersCount=v(e,A),r.fastAnswersCount=v(e,V),r.slowAnswersCount=v(e,E),r.wrongAnswersCount=v(e,L),r.score=r.correctAnswersCount*T.answersPoints.correct+r.fastAnswersCount*T.answersPoints.fast+r.slowAnswersCount*T.answersPoints.slow+n*T.liveBonus),r}function w(t){return t.map(function(t){return"tinder-like"===t.type&&(t.type="paint-or-photo"),t})}function y(t){var e=[];return t.forEach(function(t){t.answers.forEach(function(n){e.push(function(r){return new Promise(function(t,e){var n=new Image;n.src=r,n.onload=function(){return t(n)},n.onerror=function(){return e("Не удалось загрузить картнку: ".concat(r))}})}(n.image.url).then(function(t){var e=function(t,e){var n=1/(e.width/t.width),r=1/(e.height/t.height),i=n<r?n:r;return{width:e.width*i,height:e.height*i}}(n.image,t);n.image.width=e.width,n.image.height=e.height}))})}),Promise.all(e)}var k,b,x=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},S=window.location.hash.replace("#",""),L="wrong",A="correct",V="fast",E="slow",T=Object.freeze({debug:"debug"===S.toLowerCase(),spinnerRotationTime:50,levels:10,gameTime:30,tickTime:1e3,warningTime:5,slowTime:20,quickTime:10,lives:3,liveBonus:50,answersPoints:(k={},x(k,L,0),x(k,A,100),x(k,V,150),x(k,E,50),k)}),N=Object.freeze({userName:"Неопознанный Енот",lives:T.lives,time:T.gameTime,currentLevel:0,answers:[],gameResult:{score:0,success:!1}}),O=function(){function n(t){var e;return l(this,n),(e=h(this,f(n).call(this)))._answers=t,e}return p(n,d),u(n,[{key:"template",get:function(){this._liStrArr=[];for(var t=0;t<T.levels;t++)this._liStrArr.push(this._answers[t]?'<li class="stats__result stats__result--'.concat(this._answers[t],'"/>'):'<li class="stats__result stats__result--unknown"/>');return'<ul class="stats">'.concat(this._liStrArr.join(""),"</ul>")}}]),n}(),j=function(){function r(t,e){var n;return l(this,r),(n=h(this,f(r).call(this))).index=e,n._gameResult=t,n._statString=new O(t.answers),n._totalResult=_(t),n}return p(r,d),u(r,[{key:"template",get:function(){return this._totalResult.success?'\n        <table class="result__table">\n          <tr>\n              <td class="result__number">'.concat(this.index,'</td>\n              <td colspan="2">').concat(this._statString.template,'</td>\n              <td class="result__points">× 100</td>\n              <td class="result__total">').concat((this._totalResult.totalAnswersCount-this._totalResult.wrongAnswersCount)*T.answersPoints.correct,"</td>\n          </tr>\n          ").concat(0<this._totalResult.fastAnswersCount?'<tr>\n            <td></td>\n                <td class="result__extra">Бонус за скорость:</td>\n                <td class="result__extra">'.concat(this._totalResult.fastAnswersCount,'<span class="stats__result stats__result--fast"/></td>\n                <td class="result__points">× 50</td>\n                <td class="result__total">').concat(this._totalResult.fastAnswersCount*(T.answersPoints.fast-T.answersPoints.correct),"</td>\n            </tr>"):"","\n          ").concat(0<this._gameResult.lives?'<tr>\n             <td></td>\n                <td class="result__extra">Бонус за жизни:</td>\n                <td class="result__extra">2 <span class="stats__result stats__result--alive"/></td>\n                <td class="result__points">× 50</td>\n                <td class="result__total">100</td>\n             </tr>':"","\n          ").concat(0<this._totalResult.slowAnswersCount?'<tr>\n             <td></td>\n                <td class="result__extra">Штраф за медлительность:</td>\n                <td class="result__extra">'.concat(this._totalResult.slowAnswersCount,'<span class="stats__result stats__result--slow"/></td>\n                <td class="result__points">× 50</td>\n                <td class="result__total">').concat(this._totalResult.slowAnswersCount*T.answersPoints.slow,"</td>\n             </tr>"):"",'\n          <tr>\n                <td colspan="5" class="result__total  result__total--final">').concat(this._totalResult.score,"</td>\n          </tr>\n        </table>"):'<table class="result__table">\n              <tr>\n                <td class="result__number">'.concat(this.index,"</td>\n                <td>").concat(this._statString.template,'</td>\n                <td class="result__total"/>\n                <td class="result__total  result__total--final">fail</td>\n              </tr>\n            </table>')}}]),r}(),G=function(){function r(t,e){var n;return l(this,r),(n=h(this,f(r).call(this))).userName=t,e.reverse(),n.title=_(e[0]).success?"Победа!":"Вы проиграли..",n.allGamesStat=e.map(function(t,e){return new j(t,e+1).template}).join(""),n}return p(r,d),u(r,[{key:"template",get:function(){return'<section class="result">\n    <h2 class="result__title">'.concat(this.userName,"! ").concat(this.title,"</h2>\n    ").concat(this.allGamesStat,"\n    </section>")}}]),r}(),R=function(){function n(t){var e;return l(this,n),e=h(this,f(n).call(this)),t&&(e._isGameHeader=!0,e._time=t.time,e._lives=t.lives),e}return p(n,d),u(n,[{key:"onWelcomeScreen",value:function(){}},{key:"bind",value:function(){var t=this;this.element.querySelector(".back").addEventListener("click",function(){t.onWelcomeScreen()})}},{key:"template",get:function(){return this._headerTemplate="",this._buttonBackView='<button class="back">\n        <span class="visually-hidden">Вернуться к началу</span>\n        <svg class="icon" width="45" height="45" viewBox="0 0 45 45" fill="#000000">\n          <use xlink:href="img/sprite.svg#arrow-left"></use>\n        </svg>\n        <svg class="icon" width="101" height="44" viewBox="0 0 101 44" fill="#000000">\n          <use xlink:href="img/sprite.svg#logo-small"></use>\n        </svg>\n      </button>',this._headerTemplate+=this._buttonBackView,this._isGameHeader&&(this._emptyHeartHtml='<img src="img/heart__empty.svg" class="game__heart" alt=" Missed Life" width="31" height="27">',this._fullHeartHtml='<img src="img/heart__full.svg" class="game__heart" alt="Life" width="31" height="27">',this._gameTimerView='<div class="game__timer">'.concat(this._time,"</div>"),this._gameLivesView='<div class="game__lives">\n      '.concat(new Array(3-this._lives).fill(this._emptyHeartHtml).join(""),"\n      ").concat(new Array(this._lives).fill(this._fullHeartHtml).join(""),"</div>"),this._headerTemplate+=this._gameTimerView+this._gameLivesView),'<header class="header">'.concat(this._headerTemplate,"</header>")}}]),n}(),C=function(){function n(t,e){l(this,n),this.headerView=new R,this.headerView.onWelcomeScreen=n._onWelcomeScreen.bind(this),this.statisticView=new G(t,e),this.footerView=new g}return u(n,[{key:"show",value:function(){e(this.headerView.element,this.statisticView.element,this.footerView.element)}}],[{key:"_onWelcomeScreen",value:function(){nt.showGreeting()}}]),n}(),P=function(){function e(t){l(this,e),this.restart(),this._state.userName=t}return u(e,[{key:"nextLevel",value:function(){this._state=q(this._state,this._state.currentLevel+1)}},{key:"addAnswer",value:function(t){this._state.answers.push(t)}},{key:"die",value:function(){this._state=H(this.state)}},{key:"restart",value:function(){this._state=Object.assign({},N),this._state.answers=[],this._state.gameResult.score=0,this._state.gameResult.success=!1}},{key:"isDead",value:function(){return this._state.lives<=0}},{key:"tick",value:function(){this._state=D(this._state)}},{key:"resetTime",value:function(){this._state=B(this._state)}},{key:"state",get:function(){return Object.freeze(this._state)}},{key:"userName",get:function(){return this._state.userName}}]),e}(),q=function(t,e){if("number"!=typeof e)throw new Error("The level must be a number");if(e<0)throw new Error("Level should not be negative value");return Object.assign({},t,{currentLevel:e})},D=function(t){return t=Object.assign({},t,{time:t.time-1})},H=function(t){return t=Object.assign({},t,{lives:t.lives-1})},B=function(t){return t=Object.assign({},t,{time:N.time+1})},I=function(){function n(t){var e;return l(this,n),(e=h(this,f(n).call(this)))._currentGameData=t,e._gameQuestion=t.question,e.correctAnswer=e._gameQuestion.includes("Найдите фото среди изображений")?"photo":"painting",e._images=t.answers.map(function(t){return t.image}),e}return p(n,d),u(n,[{key:"onAnswer",value:function(){}},{key:"bind",value:function(){var n=this;this.element.querySelector(".game__content").addEventListener("click",function(e){var t=n._currentGameData.answers.find(function(t){return t.image.url===e.target.src}).type===n.correctAnswer;n.onAnswer(t)})}},{key:"template",get:function(){return'\n      <section class="game">\n        <p class="game__task">'.concat(this._gameQuestion,'</p>\n        <form class="game__content  game__content--triple">\n            <div class="game__option">\n                <img src="').concat(this._images[0].url,'" alt="Option 1" width=').concat(this._images[0].width," height=").concat(this._images[0].height,'>\n            </div>\n            <div class="game__option  game__option--selected">\n                <img src="').concat(this._images[1].url,'" alt="Option 2" width=').concat(this._images[1].width," height=").concat(this._images[1].height,'>\n            </div>\n            <div class="game__option">\n                <img src="').concat(this._images[2].url,'" alt="Option 3" width=').concat(this._images[2].width," height=").concat(this._images[2].height,">\n            </div>\n        </form>\n      </section>")}}]),n}(),W=function(){function n(t){var e;return l(this,n),(e=h(this,f(n).call(this)))._currentGameData=t,e._gameQuestion=t.question,e._images=t.answers.map(function(t){return t.image}),e}return p(n,d),u(n,[{key:"onAnswer",value:function(){}},{key:"bind",value:function(){var n=this;this.element.querySelector(".game__content").addEventListener("change",function(){var t=n.element.querySelectorAll("input:checked");if(t.length===n._currentGameData.answers.length){var e=Array.from(t).map(function(t){return t.value}).every(function(t,e){return t===n._currentGameData.answers[e].type});n.onAnswer(e)}})}},{key:"template",get:function(){return this._templateString=this._images.map(function(t,e){return'<div class="game__option"><img src="'.concat(t.url,'" alt="Option ').concat(++e,'" width=').concat(t.width," height=").concat(t.height,'>\n              <label class="game__answer game__answer--photo">\n                <input class="visually-hidden" name="question').concat(e,'" type="radio" value="photo">\n                <span>Фото</span>\n              </label>\n              <label class="game__answer game__answer--paint">\n                <input class="visually-hidden" name="question').concat(e,'" type="radio" value="painting">\n                <span>Рисунок</span>\n              </label></div>')}).join(""),'<section class="game"><p class="game__task">'.concat(this._gameQuestion,'</p>\n      <form class="game__content game__content--wide">').concat(this._templateString,"</form></section>")}}]),n}(),M=function(){function n(t){var e;return l(this,n),(e=h(this,f(n).call(this)))._currentGameData=t,e._gameQuestion=t.question,e._images=t.answers.map(function(t){return t.image}),e}return p(n,d),u(n,[{key:"onAnswer",value:function(){}},{key:"bind",value:function(){var n=this;this.element.querySelector(".game__content").addEventListener("change",function(){var t=n.element.querySelectorAll("input:checked");if(t.length===n._currentGameData.answers.length){var e=Array.from(t).map(function(t){return t.value}).every(function(t,e){return t===n._currentGameData.answers[e].type});n.onAnswer(e)}})}},{key:"template",get:function(){return this._templateString=this._images.map(function(t,e){return'<div class="game__option"><img src="'.concat(t.url,'" alt="Option ').concat(++e,'" width=').concat(t.width," height=").concat(t.height,'>\n              <label class="game__answer game__answer--photo">\n                <input class="visually-hidden" name="question').concat(e,'" type="radio" value="photo">\n                <span>Фото</span>\n              </label>\n              <label class="game__answer game__answer--paint">\n                <input class="visually-hidden" name="question').concat(e,'" type="radio" value="painting">\n                <span>Рисунок</span>\n              </label></div>')}).join(""),'<section class="game"><p class="game__task">'.concat(this._gameQuestion,'</p>\n      <form class="game__content">').concat(this._templateString,"</form></section>")}}]),n}(),Q=function(){function r(t,e){l(this,r),this.model=t,this.gameData=e,this.headerView=new R(this.model.state),this.gameView=r.getGameView(this.gameData[this.model.state.currentLevel]),this.statStringView=new O(this.model.state.answers),this.footerView=new g,this.root=document.querySelector("main.central"),this.root.appendChild(this.headerView.element),this.root.appendChild(this.gameView.element),this.gameNode=this.root.querySelector(".".concat(this.gameView.element.className)),this.gameNode.appendChild(this.statStringView.element),this.root.appendChild(this.footerView.element),this._timer=null}return u(r,[{key:"stop",value:function(){clearTimeout(this._timer)}},{key:"start",value:function(){e(this.headerView.element,this.gameView.element,this.footerView.element),this.changeLevel(),this.model.resetTime(),this._tick()}},{key:"restart",value:function(){this.model.isDead()&&this.model.restart(),this.start()}},{key:"end",value:function(){nt.showStats(this.model.state)}},{key:"exit",value:function(){nt.showStats(this.model)}},{key:"renderNextScreen",value:function(){!this.model.isDead()&&this.model.state.currentLevel+1<=T.levels-1?(this.model.nextLevel(),this.start()):this.end()}},{key:"updateHeader",value:function(){var t=new R(this.model.state);t.onWelcomeScreen=this._onWelcomeScreen.bind(this),this.root.replaceChild(t.element,this.root.firstChild)}},{key:"changeLevel",value:function(){this.updateHeader();var t=r.getGameView(this.gameData[this.model.state.currentLevel]);t.onAnswer=this._onAnswer.bind(this),this._changeGameView(t)}},{key:"_tick",value:function(){var t=this;this.model.tick(),this.updateHeader(),this._timer=setTimeout(function(){return t._tick()},T.tickTime),0===this.model.state.time&&this._onAnswer(!1)}},{key:"_changeGameView",value:function(t){this.root.replaceChild(t.element,this.gameView.element),this.gameView=t,this.gameNode=this.root.querySelector(".".concat(this.gameView.element.className)),this._changeStatString(),this._debug()}},{key:"_changeStatString",value:function(){this.statStringView=new O(this.model.state.answers),this.gameNode.appendChild(this.statStringView.element)}},{key:"_onAnswer",value:function(t){this.stop();var e,n=T.gameTime-this.model.state.time;e=t?r.getAnswerType(t,n):(this.model.die(),L),this.model.addAnswer(e),this.renderNextScreen()}},{key:"_onWelcomeScreen",value:function(){this.stop(),this.model.restart(),nt.showGreeting()}},{key:"_debug",value:function(){T.debug&&(console.error("debag mode ON"),this.gameData[this.model.state.currentLevel].answers.map(function(t){return console.log(t.type)}))}},{key:"element",get:function(){return this.root}}],[{key:"getGameView",value:function(t){switch(t.type){case"paint-or-photo":return new W(t);case"two-of-two":return new M(t);case"one-of-three":return new I(t);default:return new Error("Не удалось получить представление игры")}}},{key:"getAnswerType",value:function(t,e){return e<T.quickTime?V:e>T.slowTime?E:A}}]),r}(),F=function(){function t(){return l(this,t),h(this,f(t).apply(this,arguments))}return p(t,d),u(t,[{key:"onNextScreen",value:function(){}},{key:"spinnerRotate",value:function(){var t=this,e=0,n=setInterval(function(){e=e<360?e+=10:e=0,t._spinnerButton.setAttribute("style","transform:rotate(".concat(e,"deg)"))},20);return function(){clearInterval(n),t._spinnerButton.removeAttribute("style"),t._spinnerButton.lastChild.replaceWith("*")}}},{key:"bind",value:function(){var e=this;this._spinnerButton=this.element.querySelector(".intro__asterisk"),this._spinnerButton.addEventListener("click",function(t){t.preventDefault(),e.onNextScreen()})}},{key:"template",get:function(){return'<section class="intro">\n        <button class="intro__asterisk asterisk" type="button"><span class="visually-hidden">Продолжить</span>+</button>\n        <p class="intro__motto"><sup>*</sup> Это не фото. Это рисунок маслом нидерландского художника-фотореалиста Tjalf Sparnaay.</p>\n      </section>'}}]),t}(),z=function(){function t(){l(this,t),this.introView=new F,this.introView.onNextScreen=t._onNextScreen.bind(this)}return u(t,[{key:"show",value:function(){e(this.introView.element)}},{key:"spinnerStart",value:function(){return this.introView.spinnerRotate()}}],[{key:"_onNextScreen",value:function(){nt.showGreeting()}}]),t}(),Y=function(){function t(){return l(this,t),h(this,f(t).apply(this,arguments))}return p(t,d),u(t,[{key:"onNextScreen",value:function(){}},{key:"bind",value:function(){var e=this;this.element.querySelector(".greeting__continue").addEventListener("click",function(t){t.preventDefault(),e.onNextScreen()})}},{key:"template",get:function(){return'\n      <section class="greeting central--blur">\n        <img class="greeting__logo" src="img/logo_ph-big.svg" width="201" height="89" alt="Pixel Hunter">\n        <div class="greeting__asterisk asterisk"><span class="visually-hidden">Я просто красивая звёздочка</span>*</div>\n        <div class="greeting__challenge">\n          <h3 class="greeting__challenge-title">Лучшие художники-фотореалисты бросают тебе вызов!</h3>\n          <p class="greeting__challenge-text">Правила игры просты:</p>\n          <ul class="greeting__challenge-list">\n            <li>Нужно отличить рисунок от фотографии и сделать выбор.</li>\n            <li>Задача кажется тривиальной, но не думай, что все так просто.</li>\n            <li>Фотореализм обманчив и коварен.</li>\n            <li>Помни, главное — смотреть очень внимательно.</li>\n          </ul>\n        </div>\n        <button class="greeting__continue" type="button">\n          <span class="visually-hidden">Продолжить</span>\n          <svg class="icon" width="64" height="64" viewBox="0 0 64 64" fill="#000000">\n            <use xlink:href="img/sprite.svg#arrow-right"></use>\n          </svg>\n        </button>\n      </section>'}}]),t}(),J=function(){function t(){l(this,t),this.greetingView=new Y,this.footerView=new g,this.greetingView.onNextScreen=t._onNextScreen.bind(this)}return u(t,[{key:"show",value:function(){e(this.greetingView.element,this.footerView.element)}}],[{key:"_onNextScreen",value:function(){nt.showRules()}}]),t}(),K=function(){function t(){return l(this,t),h(this,f(t).apply(this,arguments))}return p(t,d),u(t,[{key:"onNextScreen",value:function(){}},{key:"bind",value:function(){var t=this,e=this.element.querySelector(".rules__input"),n=this.element.querySelector(".rules__button");e.addEventListener("input",function(t){e.minLength<=t.target.value.length&&t.target.value.length<=e.maxLength?(n.removeAttribute("disabled"),n.removeAttribute("style")):(n.setAttribute("disabled","disabled"),e.style.borderColor="red")}),n.addEventListener("click",function(){t.onNextScreen(e.value)})}},{key:"template",get:function(){return'<section class="rules">\n    <h2 class="rules__title">Правила</h2>\n    <ul class="rules__description">\n        <li>Угадай '.concat(T.levels,' раз для каждого изображения фото\n            <img class="rules__icon" src="img/icon-photo.png" width="32" height="31" alt="Фото"> или рисунок\n            <img class="rules__icon" src="img/icon-paint.png" width="32" height="31" alt="Рисунок"></li>\n        <li>Фотографиями или рисунками могут быть оба изображения.</li>\n        <li>На каждую попытку отводится ').concat(T.gameTime," секунд.</li>\n        <li>Ошибиться можно не более ").concat(T.lives,' раз.</li>\n    </ul>\n    <p class="rules__ready">Готовы?</p>\n    <form class="rules__form">\n        <input class="rules__input" type="text" placeholder="Ваше Имя" maxlength="20" minlength="3">\n        <button class="rules__button  continue" type="submit" disabled>Go!</button>\n    </form>\n  </section>')}}]),t}(),U=function(){function t(){l(this,t),this.rulesView=new K,this.headerView=new R,this.footerView=new g,this.rulesView.onNextScreen=t._onNextScreen.bind(this)}return u(t,[{key:"show",value:function(){e(this.headerView.element,this.rulesView.element,this.footerView.element)}}],[{key:"_onNextScreen",value:function(t){nt.showGame(t)}}]),t}(),X="https://es.dump.academy/pixel-hunter",Z=N.userName,$=function(){function t(){l(this,t)}var e,n,r,i,s;return u(t,null,[{key:"checkResponse",value:(s=o(a.mark(function t(e){return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok&&200===e.status)return t.abrupt("return",e);t.next=2;break;case 2:throw new Error("".concat(e.status,": ").concat(e.statusText));case 3:case"end":return t.stop()}},t)})),function(t){return s.apply(this,arguments)})},{key:"loadData",value:(i=o(a.mark(function t(e){var n;return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return n=t.sent,t.next=5,this.checkResponse(n);case 5:return t.abrupt("return",n.json());case 6:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"loadGameData",value:(r=o(a.mark(function t(){return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadData("".concat(X,"/questions"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"saveResults",value:(n=o(a.mark(function t(e){var n,r,i,s=arguments;return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=1<s.length&&void 0!==s[1]?s[1]:Z,t.next=3,JSON.stringify(e);case 3:return t.t0=t.sent,t.t1={"Content-Type":"application/json"},r={body:t.t0,headers:t.t1,method:"POST"},t.next=8,fetch("".concat(X,"/stats/").concat(322232,"-").concat(n),r);case 8:return i=t.sent,t.next=11,this.checkResponse(i);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"loadResults",value:(e=o(a.mark(function t(){var e,n=arguments;return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<n.length&&void 0!==n[0]?n[0]:Z,t.next=3,this.loadData("".concat(X,"/stats/").concat(322232,"-").concat(e));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t}(),tt=function(){function n(t){var e;return l(this,n),(e=h(this,f(n).call(this))).error=t,e}return p(n,d),u(n,[{key:"bind",value:function(){var t=this;this.element.addEventListener("click",function(){t.element.remove(),nt.showIntro()})}},{key:"template",get:function(){return'\n  <section class="modal">\n    <div class="modal__inner">\n      <h2 class="modal__title">Произошла ошибка!</h2>\n      <p class="modal__text modal__text--error">'.concat(this.error,"</p> <p>Пожалуйста, перезагрузите страницу.</p>\n    </div>\n  </section>\n    ")}}]),n}(),et=function(){function e(t){l(this,e),this.error=t,this.content=new tt(t)}return u(e,[{key:"render",value:function(){document.body.prepend(this.content.element)}}]),e}(),nt=function(){function s(){l(this,s)}var e,t;return u(s,null,[{key:"showIntro",value:(t=o(a.mark(function t(){var e,n;return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(e=new z).show(),n=e.spinnerStart(),t.prev=3,t.t0=w,t.next=7,$.loadGameData();case 7:return t.t1=t.sent,b=(0,t.t0)(t.t1),t.next=11,y(b);case 11:t.next=16;break;case 13:t.prev=13,t.t2=t.catch(3),s.showModalError("Ошибка загрузки данных  с сервера (".concat(t.t2,")"));case 16:setTimeout(n,T.spinnerRotationTime);case 17:case"end":return t.stop()}},t,null,[[3,13]])})),function(){return t.apply(this,arguments)})},{key:"showGreeting",value:function(){(new J).show()}},{key:"showRules",value:function(){(new U).show()}},{key:"showGame",value:function(t){var e=new P(t);new Q(e,b).start()}},{key:"showStats",value:(e=o(a.mark(function t(e){var n,r,i;return a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={answers:e.answers,lives:e.lives},r=e.userName,t.prev=2,t.next=5,$.saveResults(n,r);case 5:return t.next=7,$.loadResults(r);case 7:i=t.sent,new C(r,i).show(),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),s.showModalError("Ошибка загрузки статистики с сервера (".concat(t.t0,")"));case 15:case"end":return t.stop()}},t,null,[[2,12]])})),function(t){return e.apply(this,arguments)})},{key:"showModalError",value:function(t){new et(t).render()}}]),s}();nt.showIntro()}();
//# sourceMappingURL=main.js.map
